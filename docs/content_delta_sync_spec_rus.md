# üìò Content Delta Sync API Specification

## üîÑ –°—Ö–µ–º–∞ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏

```text
   Android Client                           Server
        |                                       |
        | --- GET /updates?since=...&limit= --> |
        |                                       |
        | <-- JSON { data, meta } ------------- |
        |                                       |
        | –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç upsert/delete            |
        | —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç meta.nextSince              |
        |                                       |
  (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
        | --- GET /contents/{type}/{id} ------> |
        | <------- JSON full content ---------- |
````

---

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–≠—Ç–æ—Ç API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Å—Ç–∞—Ç–µ–π, —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä.) –¥–ª—è Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –∫–∞–∫ –Ω–æ–≤—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, —Ç–∞–∫ –∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ.

–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTPS —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ Bearer-—Ç–æ–∫–µ–Ω—É.

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø—Ä–æ—Å–∞:**

```
Authorization: Bearer <access_token>
```

---

## üì• GET `/api/v1/contents/updates`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å –∑–∞–¥–∞–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ (`since`).

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø               | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                                                            |
|----------|-------------------|--------------|---------------------------------------------------------------------|
| `since`  | string (ISO 8601) | ‚úÖ –î–∞         | –î–∞—Ç–∞-–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏                                  |
| `limit`  | integer           | ‚ùå –ù–µ—Ç        | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100) |

---

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```
GET /api/v1/contents/updates?since=2024-05-01T10:00:00Z&limit=100
Authorization: Bearer eyJhbGci...
```

---

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "data": [
    {
      "id": "abc123",
      "type": "article",
      "action": "upsert",
      "updatedAt": "2024-05-01T12:30:00Z", 
      "mainImageUrl": "https://example.com/images/article/art_1.jpg",
      "attributes": {
        "title": "How to improve sleep",
        "content": "..."
      }
    },
    {
      "id": "xyz789",
      "type": "quiz",
      "action": "delete",
      "updatedAt": "2024-05-01T11:00:00Z",
      "mainImageUrl":	"https://example.com/images/quiz/3.jpg",
      "attributes": null
    }
  ],
  "meta": {
    "nextSince": "2024-05-01T12:31:00Z",
    "hasMore": false
  }
}
```

---

### –ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞

#### `data[]`

| –ü–æ–ª–µ           | –¢–∏–ø               | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
|----------------|-------------------|------------------------------------------------|
| `id`           | string            | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞               |
| `type`         | string            | –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`article`, `quiz`, `tip` –∏ —Ç.–¥.) |
| `action`       | string            | `upsert` –∏–ª–∏ `delete`                          |
| `updatedAt`    | string (ISO 8601) | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è              |
| `mainImageUrl` | string (URL)      | URl –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞                 |
| `attributes`   | object/null       | –ü–æ–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è `delete`)       |

#### `meta`

| –ü–æ–ª–µ        | –¢–∏–ø               | –û–ø–∏—Å–∞–Ω–∏–µ                                                   |
|-------------|-------------------|------------------------------------------------------------|
| `nextSince` | string (ISO 8601) | –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–æ–≤–∞—è –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏) |
| `hasMore`   | boolean           | –ï—Å—Ç—å –ª–∏ –µ—â—ë –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞               |

---

## üìÑ GET `/api/v1/contents/{type}/{id}`

–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–µ –ø–æ –µ–≥–æ —Ç–∏–ø—É –∏ ID.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

* `{type}` ‚Äî —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
* `{id}` ‚Äî ID –æ–±—ä–µ–∫—Ç–∞

---

## üîÅ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∏–µ–Ω—Ç–∞

1. –•—Ä–∞–Ω–∏—Ç—å `lastSyncAt` –≤ `SharedPreferences` –∏–ª–∏ –ë–î.
2. –ü—Ä–∏ pull-to-refresh –∏–ª–∏ —Ñ–æ–Ω–æ–≤–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:

    * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å `GET /contents/updates?since=lastSyncAt`.
    * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å `upsert` –∏ `delete` –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É.
    * –û–±–Ω–æ–≤–∏—Ç—å `lastSyncAt` –¥–æ –∑–Ω–∞—á–µ–Ω–∏—è `meta.nextSince`.

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –°–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `action: delete` –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.
* `nextSince` ‚Äî —ç—Ç–æ ISO 8601-—Å—Ç—Ä–æ–∫–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è `max(updatedAt)` –≤ –æ—Ç–≤–µ—Ç–µ.
* –í—Å–µ –¥–∞—Ç—ã –≤ UTC.

