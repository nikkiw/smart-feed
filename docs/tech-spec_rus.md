# Техническая спецификация для MVP `smart-feed`

## 1. Общее описание

**Название проекта:** smart-feed
**Описание:** MVP-приложение на Android с лентой статей и встроенной системой рекомендаций на устройстве.
**Стек технологий:** Kotlin, Android MVVM, Coroutines, Room, WorkManager, Hilt, Retrofit, Decompose (для навигации и жизненного цикла компонентов на мультиплатформе), TensorFlow Lite (опционально для эмбеддингов), GitHub Actions CI.

## 2. Цели

* Реализовать минимально жизнеспособный продукт (MVP) с динамической лентой и персонализированными рекомендациями, вычисляемыми локально.
* Обеспечить модульную архитектуру с поддержкой статических и динамических модулей контента.
* Сохранить высокое качество кода, покрытие тестами и интеграцию CI/CD.
* Подготовить понятную документацию и лицензию для включения в портфолио.

## 3. Функциональные требования

1. **Статическая лента статей**

    * Отображение предзагруженных статей по категориям.
    * Просмотр деталей статьи, возможность добавления в закладки и шеринга.

2. **Динамическая лента с сервера**

    * Получение статей через REST API.
    * Сохранение статей в Room с отметкой времени синхронизации.
    * Поддержка ручного pull-to-refresh и периодической синхронизации через WorkManager.

3. **Система рекомендаций (локально на устройстве)**

    * Расчёт эмбеддингов для всех статей.
    * Формирование пользовательского профиля через усреднение эмбеддингов прочитанных статей.
    * Расчёт косинусного сходства и выбор top-N непрочитанных статей.
    * Горизонтальный список “Рекомендовано для Вас” в ленте.

4. **События взаимодействия пользователя**

    * Логирование событий: `view_article`, `bookmark`, `share`, `complete_test`, `read_time`.
    * Сохранение событий в таблице `event_logs` для аналитики.

5. **UI/UX**

    * Сегментированный контрол: Все | Статьи | Тесты | Рекомендовано.
    * Бейджи “New” или “For You” на карточках.
    * Pull-to-refresh и бесконечная прокрутка.

6. **Тестирование и CI**

    * Юнит-тесты для ViewModel, UseCase и DAO.
    * GitHub Actions для запуска lint, сборки и тестов.

## 4. Нефункциональные требования

* **Производительность:** Отрисовка ленты — до 300 мс, расчёт рекомендаций — до 200 мс на среднем устройстве.
* **Масштабируемость:** Модульная структура с возможностью добавления видео, подкастов, серверной CF.
* **Безопасность:** Очистка входных данных, HTTPS.
* **Поддерживаемость:** Kotlin style guide, комментирование кода, документация в `docs/`.
* **Совместимость:** Android SDK 23+, минимум JDK 17.

## 5. Архитектура и модули

```plaintext
smart-feed/
├── app/             # Модуль приложения:  UI, навигация, ViewModel, DI (на основе Decompose)
├── build-logic/     # Собственные Gradle-конвенции и плагины:
├── buildSrc/        # Конфигурация приложения и глобальные константы:
├── core/            # Общие модели и утилиты, используемые по всему проекту:
├── docs/            # Документация в Markdown
└── mock-server/     # Мок-сервер для локальной разработки и тестирования:
```

* **Навигация и управление состоянием:** Используется Decompose вместо Android Navigation Component — управление жизненным циклом, состоянием, поддержка мультиплатформы.
* **Модульность:** Каждый модуль предоставляет свои компоненты через Decompose.
* **Внедрение зависимостей:** Передача `ComponentContext` из Hilt в ViewModel и UseCase.

## 6. Модели данных

* **Article:** id, title, summary, content, imageUrl, category, createdAt
* **RemoteArticle:** наследует Article, добавлены `fetchedAt` и `isRead`
* **Recommendation:** articleId, score, generatedAt
* **EventLog:** eventId, userId, type, payload (JSON), timestamp

## 7. API спецификация

Полное описание API представлено в файле [content_delta_sync_spec_rus.md](/docs/content_delta_sync_spec_rus.md).


## 8. Экраны и пользовательский поток

1. **FeedFragment**

    * Заголовок и иконка поиска.
    * Сегментированный контрол.
    * Вертикальный RecyclerView с карточками разных типов.

2. **ArticleDetailFragment**

    * Заголовок, баннер, полный текст статьи.
    * Кнопки “в закладки” и “поделиться”.

3. **TestFragment**

    * Список мини-тестов.
    * Прогресс и результаты.

## 9. WorkManager конфигурация

* **SyncWorker:** периодическая задача (например, раз в 6 часов) — загрузка новых статей и обновление рекомендаций.
* **Ограничения:** NetworkType.CONNECTED, device idle — опционально.

## 10. Внедрение зависимостей

* Через Hilt предоставляются:

    * Singleton `RoomDatabase`
    * Retrofit-инстанс `FeedApiService`
    * DAO: `RemoteArticleDao`, `RecommendationDao`, `EventLogDao`
    * UseCase и Repository биндинги

## 11. Стратегия тестирования

* **Юнит-тесты:** JUnit + Mockito (или MockK) для ViewModel и UseCase
* **Инструментальные тесты:** поведение Room
* **CI:** GitHub Actions `.github/workflows/android-ci.yml`, запуск на push и PR

## 12. Дорожная карта и улучшения

* **Серверная коллаборативная фильтрация**
* **Гибридные рекомендации:** CF + content-based
* **Новые типы контента:** видео, аудио, опросы
* **Аналитика:** дашборд метрик вовлечённости

