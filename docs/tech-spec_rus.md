# Техническая спецификация для MVP `smart-feed`

## 1. Общее описание

**Название проекта:** smart-feed
**Описание:** Demo-приложение на Android с лентой статей и встроенной системой рекомендаций на устройстве.
**Стек технологий:** Kotlin, Android MVVM, Coroutines, Room, WorkManager, Hilt, Retrofit, Decompose (для навигации разбиения сложных экранов на BloC), GitHub Actions CI.

## 2. Цели

* Реализовать пример с динамической лентой и персонализированными рекомендациями, вычисляемыми локально.
* Обеспечить модульную архитектуру с поддержкой динамических модулей контента.
* Сохранить высокое качество кода, покрытие тестами и интеграцию CI/CD.
* Подготовить понятную документацию и лицензию для включения в портфолио.

## 3. Функциональные требования

1. **Динамическая лента с сервера**

    * Получение статей через REST API.
    * Сохранение статей в Room с отметкой времени синхронизации.
    * Поддержка ручного pull-to-refresh и периодической синхронизации через WorkManager.

2. **Система рекомендаций (локально на устройстве)**

    * Формирование пользовательского профиля через взвешивание эмбеддингов прочитанных статей.
    * Формирование для статьи (контента) рекомендаций к чтению (Recommended reading)

3. **События взаимодействия пользователя**

    * Логирование событий: `read` для контента (ид контента, число раз чтения, процент прочтения и время чтения)
    * Сохранение событий в таблице `event_logs` для аналитики и агрегация их в `content_interaction_stats`

4. **UI/UX**

    * Bottom: Feed | Recommendations.
    * Pull-to-refresh и бесконечная прокрутка.
    * Периодическое обновление контента

5. **Тестирование и CI**
    
    * Android test для тестирования SQLite и других специфических вещей
    * Юнит-тесты для ViewModel, UseCase и DAO.
    * GitHub Actions для запуска lint, сборки и тестов.

## 4. Нефункциональные требования

* **Масштабируемость:** Модульная структура с возможностью добавления видео, подкастов, серверной CF.
* **Поддерживаемость:** Kotlin style guide, комментирование кода, документация в `docs/`.
* **Совместимость:** Android SDK 23+, минимум JDK 17.

## 5. Архитектура и модули

```plaintext
smart-feed/
├── app/             # Модуль приложения:  UI, навигация, ViewModel, DI (на основе Decompose)
├── build-logic/     # Собственные Gradle-конвенции и плагины:
├── buildSrc/        # Конфигурация приложения и глобальные константы:
├── core/            # Общие модели и утилиты, используемые по всему проекту:
├── docs/            # Документация в Markdown
├── feature/         # Компоненты decompose и ui отображения
├── mock-server/     # Мок-сервер для локальной разработки и тестирования
└── scripts/         # Phython срипты для генерации данных (тестовых)
```

* **Навигация и управление состоянием:** Используется Decompose вместо Android Navigation Component — управление жизненным циклом, состоянием, поддержка мультиплатформы.
* **Модульность:** Каждый модуль предоставляет свои компоненты через Decompose.
* **Внедрение зависимостей:** Передача компонентов из Hilt в ViewModel и UseCase.

## 6. API спецификация

Полное описание API представлено в файле [content_delta_sync_spec_rus.md](/docs/content_delta_sync_spec_rus.md).

## 7. Экраны и пользовательский поток

1. **FeedRoot**
   
   * FeedScreen или RecommendationScreen (в зависимости от состояния).
   * BottomBar для переключений между FeedScreen, RecommendationScreen

2. **FeedScreen**

    * FilterSortScreen для выбора сортировки feed, и фильтрация по тегам.
    * Вертикальный RecyclerView с карточками разных типов.

3. **ArticleDetailScreen**

    * Заголовок, баннер, полный текст статьи.
    * Список рекомендаций к чтению (Recommended reading)

4. **RecommendationScreen**

    * Список рекомендаций к чтению (Recommended reading)

## 9. WorkManager конфигурация

* **ContentFetchScheduler** настройка расписаний и условий для выполнения ContentFetchWorker
* **ContentFetchWorker:** периодическая задача — загрузка новых статей и обновление рекомендаций.
* **Ограничения:** NetworkType.CONNECTED, device idle — опционально.

## 10. Внедрение зависимостей

* Через Hilt

## 11. Стратегия тестирования

* **Юнит-тесты:** JUnit + или MockK для ViewModel и UseCase
* **Инструментальные тесты:** поведение Room, Sqlite, Worker
* **CI:** GitHub Actions `.github/workflows/android-ci.yml`, запуск на push и PR

## 12. Дорожная карта и улучшения

* **Построение и публикация документации**
* **Агрегация и сводное покрытие тестов**
* **Поддержка разных размеров экранов**
* **Новые типы контента:** видео, аудио, опросы
* **Аналитика:** дашборд метрик вовлечённости
